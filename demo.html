<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Semiconductor Device Viewer — OpenTCAD.dev</title>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QZ407JK5J3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-QZ407JK5J3');
</script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap');
  :root {
    --bg:#0a0e17;--bg2:#111827;--bg3:#0d1220;--bgp:rgba(17,24,39,0.92);
    --bdr:rgba(99,130,255,0.12);--bdr2:rgba(99,130,255,0.06);
    --acc:#6382ff;--accg:rgba(99,130,255,0.3);--acc2:#4f6ce5;
    --t1:#e2e8f0;--t2:#94a3b8;--t3:#64748b;--t4:#475569;
    --sidebar-w:260px;--topbar-h:40px;
    --green:#4ade80;--amber:#fbbf24;--red:#f87171;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--t1);font-family:'Outfit',sans-serif;overflow:hidden;height:100vh;width:100vw;display:flex;flex-direction:column;}

  /* ── Top Bar ── */
  .topbar{height:var(--topbar-h);background:var(--bg3);border-bottom:1px solid var(--bdr);display:flex;align-items:center;padding:0 12px;gap:10px;flex-shrink:0;z-index:100;}
  .logo{font-family:'JetBrains Mono',monospace;font-weight:600;font-size:13px;color:var(--acc);white-space:nowrap;}
  .logo span{color:var(--t3);font-weight:300;}
  .dvd{width:1px;height:16px;background:var(--bdr);flex-shrink:0;}
  .topbar-info{font-size:11px;color:var(--t2);font-weight:300;}
  .topbar-info strong{color:var(--t1);font-weight:500;}
  .topbar-right{margin-left:auto;display:flex;align-items:center;gap:8px;}
  .status-dot{width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);}
  .status-text{font-size:10px;color:var(--t3);font-family:'JetBrains Mono',monospace;}

  /* ── Main Layout ── */
  .main{display:flex;flex:1;overflow:hidden;}

  /* ── Left Sidebar ── */
  .sidebar{width:var(--sidebar-w);min-width:var(--sidebar-w);background:var(--bg3);border-right:1px solid var(--bdr);display:flex;flex-direction:column;overflow:hidden;z-index:10;}

  /* Sidebar section */
  .sb-section{border-bottom:1px solid var(--bdr);overflow:hidden;}
  .sb-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px 8px;cursor:pointer;user-select:none;}
  .sb-header:hover{background:rgba(99,130,255,0.04);}
  .sb-title{font-size:9px;text-transform:uppercase;letter-spacing:1.8px;color:var(--t3);font-weight:600;}
  .sb-chevron{font-size:10px;color:var(--t4);transition:transform .2s;}
  .sb-section.collapsed .sb-body{display:none;}
  .sb-section.collapsed .sb-chevron{transform:rotate(-90deg);}
  .sb-body{padding:4px 12px 12px;}

  /* Process steps list */
  .step-list{display:flex;flex-direction:column;gap:2px;}
  .step-item{display:flex;align-items:center;gap:8px;padding:6px 8px;border-radius:6px;cursor:pointer;transition:all .15s;position:relative;font-size:11px;color:var(--t2);}
  .step-item:hover{background:rgba(99,130,255,0.06);color:var(--t1);}
  .step-item.active{background:rgba(99,130,255,0.1);color:var(--acc);border:1px solid rgba(99,130,255,0.2);}
  .step-item.completed{color:var(--t2);}
  .step-num{width:18px;height:18px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:600;flex-shrink:0;border:1px solid var(--bdr);background:var(--bg2);color:var(--t3);transition:all .15s;}
  .step-item.active .step-num{background:rgba(99,130,255,0.15);border-color:var(--acc);color:var(--acc);}
  .step-item.completed .step-num{background:rgba(74,222,128,0.1);border-color:rgba(74,222,128,0.3);color:var(--green);}
  .step-name{font-weight:400;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

  /* Parameters */
  .param-grid{display:grid;grid-template-columns:1fr 1fr;gap:4px;}
  .param-cell{display:flex;flex-direction:column;gap:1px;padding:5px 7px;background:var(--bg2);border:1px solid var(--bdr2);border-radius:5px;}
  .param-key{font-size:9px;color:var(--t4);font-family:'JetBrains Mono',monospace;text-transform:uppercase;letter-spacing:0.5px;}
  .param-val{font-size:11px;color:var(--t1);font-weight:500;font-family:'JetBrains Mono',monospace;}

  /* Materials legend */
  .mat-list{display:flex;flex-direction:column;gap:3px;}
  .mat-item{display:flex;align-items:center;gap:8px;padding:3px 0;font-size:11px;color:var(--t2);}
  .mat-swatch{width:10px;height:10px;border-radius:2px;flex-shrink:0;border:1px solid rgba(255,255,255,0.06);}

  /* Display toggles */
  .toggle-list{display:flex;flex-direction:column;gap:4px;}
  .toggle-row{display:flex;align-items:center;justify-content:space-between;padding:2px 0;}
  .toggle-label{font-size:11px;color:var(--t2);}
  .tgw{position:relative;width:30px;height:16px;cursor:pointer;flex-shrink:0;}
  .tgw input{opacity:0;width:0;height:0;position:absolute;}
  .tgsl{position:absolute;inset:0;background:var(--bg2);border:1px solid var(--bdr);border-radius:8px;transition:.2s;}
  .tgsl::before{content:'';position:absolute;width:10px;height:10px;left:2px;top:2px;background:var(--t3);border-radius:50%;transition:.2s;}
  .tgw input:checked+.tgsl{background:rgba(99,130,255,.2);border-color:var(--acc);}
  .tgw input:checked+.tgsl::before{transform:translateX(14px);background:var(--acc);}

  /* Controls help */
  .ctrl-list{display:flex;flex-direction:column;gap:4px;}
  .ctrl-row{display:flex;align-items:center;gap:6px;font-size:10px;color:var(--t3);}
  .ctrl-key{font-family:'JetBrains Mono',monospace;font-size:9px;background:var(--bg2);border:1px solid var(--bdr);border-radius:3px;padding:2px 5px;color:var(--t2);min-width:36px;text-align:center;}

  /* ── Viewport ── */
  .viewport{flex:1;position:relative;overflow:hidden;}
  #cv{width:100%;height:100%;}
  .vp-badge{position:absolute;bottom:10px;left:10px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--t4);background:rgba(10,14,23,0.7);backdrop-filter:blur(8px);padding:4px 10px;border-radius:6px;border:1px solid var(--bdr2);pointer-events:none;}
  .vp-step-label{position:absolute;top:10px;left:50%;transform:translateX(-50%);font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--t2);background:rgba(10,14,23,0.75);backdrop-filter:blur(12px);padding:5px 14px;border-radius:8px;border:1px solid var(--bdr);pointer-events:none;white-space:nowrap;}
  .vp-step-label strong{color:var(--acc);font-weight:600;}

  /* ── Loading overlay ── */
  .lo{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:1000;transition:opacity .5s;}
  .lo.h{opacity:0;pointer-events:none;}
  .ls{width:28px;height:28px;border:2px solid var(--bdr);border-top-color:var(--acc);border-radius:50%;animation:sp .7s linear infinite;margin-bottom:10px;}
  .lt{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--t3);}
  @keyframes sp{to{transform:rotate(360deg);}}

  /* ── Scrollbar ── */
  .sidebar::-webkit-scrollbar{width:4px;}
  .sidebar::-webkit-scrollbar-track{background:transparent;}
  .sidebar::-webkit-scrollbar-thumb{background:var(--bdr);border-radius:2px;}

  /* ── Responsive ── */
  @media(max-width:700px){
    .sidebar{width:200px;min-width:200px;}
  }
  @media(max-width:520px){
    .main{flex-direction:column;}
    .sidebar{width:100%;min-width:100%;max-height:40vh;overflow-y:auto;border-right:none;border-bottom:1px solid var(--bdr);}
    .viewport{min-height:50vh;}
  }
</style>
</head>
<body>

<!-- Loading -->
<div class="lo" id="ld"><div class="ls"></div><div class="lt">Initializing 3D Viewer...</div></div>

<!-- Top Bar -->
<div class="topbar">
  <div class="logo">OpenTCAD<span>.dev</span></div>
  <div class="dvd"></div>
  <div class="topbar-info"><strong>FinFET Process Flow</strong> — 7 steps</div>
  <div class="topbar-right">
    <span class="topbar-info" id="vc">Voxels: —</span>
    <div class="dvd"></div>
    <div class="status-dot"></div>
    <span class="status-text">Ready</span>
  </div>
</div>

<!-- Main Layout -->
<div class="main">

  <!-- Left Sidebar -->
  <div class="sidebar">

    <!-- Process Steps -->
    <div class="sb-section" id="sec-steps">
      <div class="sb-header" onclick="toggleSection('sec-steps')">
        <span class="sb-title">Process Steps</span>
        <span class="sb-chevron">▼</span>
      </div>
      <div class="sb-body">
        <div class="step-list" id="step-list"></div>
      </div>
    </div>

    <!-- Parameters -->
    <div class="sb-section" id="sec-params">
      <div class="sb-header" onclick="toggleSection('sec-params')">
        <span class="sb-title">Parameters</span>
        <span class="sb-chevron">▼</span>
      </div>
      <div class="sb-body">
        <div class="param-grid" id="param-grid"></div>
      </div>
    </div>

    <!-- Materials -->
    <div class="sb-section" id="sec-mats">
      <div class="sb-header" onclick="toggleSection('sec-mats')">
        <span class="sb-title">Materials</span>
        <span class="sb-chevron">▼</span>
      </div>
      <div class="sb-body">
        <div class="mat-list">
          <div class="mat-item"><div class="mat-swatch" style="background:#5b7fa6"></div>Silicon</div>
          <div class="mat-item"><div class="mat-swatch" style="background:#c4956a"></div>SiO₂</div>
          <div class="mat-item"><div class="mat-swatch" style="background:#7ab87a"></div>Si₃N₄</div>
          <div class="mat-item"><div class="mat-swatch" style="background:#c97a7a"></div>Poly-Si</div>
          <div class="mat-item"><div class="mat-swatch" style="background:#b8b8b8"></div>TiN Metal</div>
          <div class="mat-item"><div class="mat-swatch" style="background:#76a8e8"></div>N+ Implant</div>
          <div class="mat-item"><div class="mat-swatch" style="background:#e87676"></div>P-body</div>
        </div>
      </div>
    </div>

    <!-- Display Options -->
    <div class="sb-section" id="sec-display">
      <div class="sb-header" onclick="toggleSection('sec-display')">
        <span class="sb-title">Display</span>
        <span class="sb-chevron">▼</span>
      </div>
      <div class="sb-body">
        <div class="toggle-list">
          <div class="toggle-row"><span class="toggle-label">Wireframe</span><label class="tgw"><input type="checkbox" id="tw"><span class="tgsl"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">Cross-section</span><label class="tgw"><input type="checkbox" id="ts"><span class="tgsl"></span></label></div>
          <div class="toggle-row"><span class="toggle-label">Auto-rotate</span><label class="tgw"><input type="checkbox" id="ta"><span class="tgsl"></span></label></div>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="sb-section" id="sec-ctrl">
      <div class="sb-header" onclick="toggleSection('sec-ctrl')">
        <span class="sb-title">Controls</span>
        <span class="sb-chevron">▼</span>
      </div>
      <div class="sb-body">
        <div class="ctrl-list">
          <div class="ctrl-row"><span class="ctrl-key">Drag</span>Rotate view</div>
          <div class="ctrl-row"><span class="ctrl-key">Scroll</span>Zoom in/out</div>
          <div class="ctrl-row"><span class="ctrl-key">R-click</span>Pan</div>
          <div class="ctrl-row"><span class="ctrl-key">← →</span>Prev / Next step</div>
        </div>
      </div>
    </div>

  </div>

  <!-- 3D Viewport -->
  <div class="viewport">
    <div id="cv"></div>
    <div class="vp-step-label" id="vp-label"><strong>Step 1/7</strong> — Si Substrate</div>
    <div class="vp-badge" id="vp-badge">Voxels: —</div>
  </div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
/* ── Section collapse ── */
function toggleSection(id){document.getElementById(id).classList.toggle('collapsed');}

/* ── Process Data ── */
const ST=[
  {n:"Si Substrate",s:"SUBSTR",p:{mat:"Si",orient:"(100)",dop:"P 1e15"}},
  {n:"STI Oxidation",s:"STI OX",p:{proc:"Thermal",T:"1000°C",t:"30min"}},
  {n:"Fin Etch",s:"FIN ETCH",p:{proc:"RIE",d:"80nm",w:"7nm"}},
  {n:"Gate Oxide",s:"GOX",p:{proc:"ALD HfO₂",t:"1.2nm",κ:"22"}},
  {n:"Gate Deposit",s:"GATE DEP",p:{mat:"TiN+Poly",t:"40nm"}},
  {n:"Gate Etch",s:"GATE ETCH",p:{proc:"Aniso RIE",Lg:"14nm"}},
  {n:"S/D Implant",s:"S/D IMP",p:{ion:"Phos",E:"5keV",dose:"5e14"}}
];
const NX=40,NY=24,NZ=30;
const E=0,SI=1,OX=2,NI=3,PO=4,ME=5,NP=6,PB=7;
const CC={[SI]:0x5b7fa6,[OX]:0xc4956a,[NI]:0x7ab87a,[PO]:0xc97a7a,[ME]:0xb8b8b8,[NP]:0x76a8e8,[PB]:0xe87676};
const ix=(x,y,z)=>x+NX*(y+NY*z);
function fb(g,x0,y0,z0,x1,y1,z1,m){for(let z=z0;z<z1;z++)for(let y=y0;y<y1;y++)for(let x=x0;x<x1;x++)if(x>=0&&x<NX&&y>=0&&y<NY&&z>=0&&z<NZ)g[ix(x,y,z)]=m;}
function bg(){
  const gs=[];let g=new Uint8Array(NX*NY*NZ);
  fb(g,0,0,0,NX,12,NZ,SI);gs.push(g);
  g=new Uint8Array(gs[0]);fb(g,0,6,0,12,12,NZ,OX);fb(g,28,6,0,NX,12,NZ,OX);gs.push(g);
  g=new Uint8Array(gs[1]);
  for(let x=12;x<28;x++)for(let z=0;z<NZ;z++)for(let y=10;y<16;y++){if(!((x>=14&&x<=16)||(x>=19&&x<=21)||(x>=24&&x<=26)))g[ix(x,y,z)]=E;}
  for(let z=0;z<NZ;z++){fb(g,14,12,z,17,17,z+1,SI);fb(g,19,12,z,22,17,z+1,SI);fb(g,24,12,z,27,17,z+1,SI);}
  gs.push(g);
  g=new Uint8Array(gs[2]);
  for(let z=10;z<20;z++){
    fb(g,13,12,z,14,17,z+1,OX);fb(g,17,12,z,18,17,z+1,OX);fb(g,14,17,z,17,18,z+1,OX);
    fb(g,18,12,z,19,17,z+1,OX);fb(g,22,12,z,23,17,z+1,OX);fb(g,19,17,z,22,18,z+1,OX);
    fb(g,23,12,z,24,17,z+1,OX);fb(g,27,12,z,28,17,z+1,OX);fb(g,24,17,z,27,18,z+1,OX);
  }gs.push(g);
  g=new Uint8Array(gs[3]);
  for(let z=10;z<20;z++){
    fb(g,12,12,z,28,20,z+1,ME);
    fb(g,13,12,z,18,17,z+1,OX);fb(g,14,12,z,17,17,z+1,SI);fb(g,14,17,z,17,18,z+1,OX);
    fb(g,18,12,z,23,17,z+1,OX);fb(g,19,12,z,22,17,z+1,SI);fb(g,19,17,z,22,18,z+1,OX);
    fb(g,23,12,z,28,17,z+1,OX);fb(g,24,12,z,27,17,z+1,SI);fb(g,24,17,z,27,18,z+1,OX);
    fb(g,12,18,z,28,22,z+1,PO);
  }gs.push(g);
  g=new Uint8Array(gs[4]);
  for(let z=0;z<NZ;z++)if(z<12||z>=18)for(let y=12;y<22;y++)for(let x=12;x<28;x++){const m=g[ix(x,y,z)];if(m===ME||m===PO)g[ix(x,y,z)]=E;if(m===OX&&y>=17)g[ix(x,y,z)]=E;}
  gs.push(g);
  g=new Uint8Array(gs[5]);
  for(let z=0;z<NZ;z++)if(z<12||z>=18)for(let y=12;y<17;y++)for(let x=12;x<28;x++)if(g[ix(x,y,z)]===SI)g[ix(x,y,z)]=NP;
  for(let z=0;z<NZ;z++)for(let x=12;x<28;x++)for(let y=0;y<10;y++)if(g[ix(x,y,z)]===SI)g[ix(x,y,z)]=PB;
  gs.push(g);return gs;
}

let sc,ca,re,cm=[],cs=0,gr,wf=false,sl=false,ar=false,dr=false,rd=false,pv={x:0,y:0};
let sp={t:.8,p:1,r:65},tg=new THREE.Vector3(NX/2*Math.SQRT1_2,8,NZ/2*Math.SQRT1_2);

function init(){
  sc=new THREE.Scene();sc.background=new THREE.Color(0x2e3440);
  ca=new THREE.PerspectiveCamera(45,1,.1,1000);
  re=new THREE.WebGLRenderer({antialias:true});re.setPixelRatio(Math.min(devicePixelRatio,2));
  document.getElementById('cv').appendChild(re.domElement);
  resizeViewport();

  sc.add(new THREE.AmbientLight(0x8090a0,.8));
  const dl=new THREE.DirectionalLight(0xffffff,.9);dl.position.set(30,50,40);sc.add(dl);
  const fl=new THREE.DirectionalLight(0x8899bb,.4);fl.position.set(-20,20,-10);sc.add(fl);
  const gh=new THREE.GridHelper(80,40,0x3d4555,0x353b4a);gh.position.set(NX/2*Math.SQRT1_2,-.5,NZ/2*Math.SQRT1_2);sc.add(gh);

  const el=re.domElement;
  el.addEventListener('mousedown',e=>{dr=true;rd=e.button===2;pv={x:e.clientX,y:e.clientY};});
  el.addEventListener('mousemove',e=>{if(!dr)return;const dx=e.clientX-pv.x,dy=e.clientY-pv.y;pv={x:e.clientX,y:e.clientY};
    if(rd){const r=new THREE.Vector3();r.crossVectors(ca.getWorldDirection(new THREE.Vector3()),new THREE.Vector3(0,1,0)).normalize();tg.add(r.multiplyScalar(-dx*.05));tg.y+=dy*.05;}
    else{sp.t+=dx*.005;sp.p-=dy*.005;sp.p=Math.max(.1,Math.min(Math.PI-.1,sp.p));}});
  el.addEventListener('mouseup',()=>dr=false);el.addEventListener('mouseleave',()=>dr=false);
  el.addEventListener('wheel',e=>{sp.r+=e.deltaY*.05;sp.r=Math.max(20,Math.min(150,sp.r));},{passive:true});
  el.addEventListener('contextmenu',e=>e.preventDefault());

  let ltd=0,lt={x:0,y:0};
  el.addEventListener('touchstart',e=>{if(e.touches.length===1){dr=true;lt={x:e.touches[0].clientX,y:e.touches[0].clientY};}
    if(e.touches.length===2){const dx=e.touches[0].clientX-e.touches[1].clientX,dy=e.touches[0].clientY-e.touches[1].clientY;ltd=Math.sqrt(dx*dx+dy*dy);}},{passive:true});
  el.addEventListener('touchmove',e=>{e.preventDefault();
    if(e.touches.length===1&&dr){const dx=e.touches[0].clientX-lt.x,dy=e.touches[0].clientY-lt.y;lt={x:e.touches[0].clientX,y:e.touches[0].clientY};sp.t+=dx*.005;sp.p-=dy*.005;sp.p=Math.max(.1,Math.min(Math.PI-.1,sp.p));}
    if(e.touches.length===2){const dx=e.touches[0].clientX-e.touches[1].clientX,dy=e.touches[0].clientY-e.touches[1].clientY,d=Math.sqrt(dx*dx+dy*dy);sp.r+=(ltd-d)*.15;sp.r=Math.max(20,Math.min(150,sp.r));ltd=d;}},{passive:false});
  el.addEventListener('touchend',()=>dr=false);

  document.addEventListener('keydown',e=>{if(e.key==='ArrowRight')ss(Math.min(cs+1,gr.length-1));if(e.key==='ArrowLeft')ss(Math.max(cs-1,0));});

  gr=bg();buildStepList();ss(0);
  setTimeout(()=>document.getElementById('ld').classList.add('h'),400);
  an();
}

function resizeViewport(){
  const vp=document.querySelector('.viewport');
  const w=vp.clientWidth,h=vp.clientHeight;
  ca.aspect=w/h;ca.updateProjectionMatrix();
  re.setSize(w,h);
}

function bm(g){
  const mv={};let tot=0;
  for(let z=0;z<NZ;z++)for(let y=0;y<NY;y++)for(let x=0;x<NX;x++){
    const m=g[ix(x,y,z)];if(m===E)continue;if(sl&&z>=NZ/2)continue;
    let ex=false;for(const[dx,dy,dz]of[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]]){
      const nx=x+dx,ny=y+dy,nz=z+dz;
      if(nx<0||nx>=NX||ny<0||ny>=NY||nz<0||nz>=NZ){ex=true;break;}
      if(sl&&nz>=NZ/2){ex=true;break;}
      if(g[ix(nx,ny,nz)]===E||g[ix(nx,ny,nz)]!==m){ex=true;break;}}
    if(!ex)continue;if(!mv[m])mv[m]=[];mv[m].push([x,y,z]);tot++;}
  const voxText=`Voxels: ${tot.toLocaleString()}`;
  document.getElementById('vc').textContent=voxText;
  document.getElementById('vp-badge').textContent=voxText;
  const ms=[],bx=new THREE.BoxGeometry(Math.SQRT1_2,1,Math.SQRT1_2);
  for(const[mt,ps]of Object.entries(mv)){
    const ma=new THREE.MeshPhongMaterial({color:CC[parseInt(mt)]||0xffffff,wireframe:wf,transparent:true,opacity:wf?.6:.92,shininess:60,specular:0x222233});
    const im=new THREE.InstancedMesh(bx,ma,ps.length),d=new THREE.Object3D();
    ps.forEach(([x,y,z],i)=>{d.position.set(x*Math.SQRT1_2,y,z*Math.SQRT1_2);d.updateMatrix();im.setMatrixAt(i,d.matrix);});
    im.castShadow=false;im.receiveShadow=false;ms.push(im);}
  return ms;
}

function ss(i){cm.forEach(m=>sc.remove(m));cs=i;cm=bm(gr[i]);cm.forEach(m=>sc.add(m));uu();}

function buildStepList(){
  const list=document.getElementById('step-list');
  list.innerHTML='';
  ST.forEach((s,i)=>{
    const el=document.createElement('div');
    el.className='step-item';
    el.innerHTML=`<div class="step-num">${i+1}</div><span class="step-name">${s.n}</span>`;
    el.addEventListener('click',()=>ss(i));
    list.appendChild(el);
  });
}

function uu(){
  /* Update step list */
  document.querySelectorAll('.step-item').forEach((el,i)=>{
    el.classList.toggle('active',i===cs);
    el.classList.toggle('completed',i<cs);
  });
  /* Update viewport label */
  document.getElementById('vp-label').innerHTML=`<strong>Step ${cs+1}/7</strong> — ${ST[cs].n}`;
  /* Update parameters */
  const pg=document.getElementById('param-grid');
  pg.innerHTML=Object.entries(ST[cs].p).map(([k,v])=>`<div class="param-cell"><span class="param-key">${k}</span><span class="param-val">${v}</span></div>`).join('');
}

function an(){requestAnimationFrame(an);if(ar&&!dr)sp.t+=.002;
  ca.position.set(tg.x+sp.r*Math.sin(sp.p)*Math.cos(sp.t),tg.y+sp.r*Math.cos(sp.p),tg.z+sp.r*Math.sin(sp.p)*Math.sin(sp.t));
  ca.lookAt(tg);re.render(sc,ca);}

addEventListener('resize',()=>resizeViewport());
document.getElementById('tw').addEventListener('change',e=>{wf=e.target.checked;ss(cs);});
document.getElementById('ts').addEventListener('change',e=>{sl=e.target.checked;ss(cs);});
document.getElementById('ta').addEventListener('change',e=>{ar=e.target.checked;});
init();
</script>
</body>
</html>
